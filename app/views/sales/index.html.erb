<div class="container theme-showcase" role="main">
  <div class="page-header">
    <h1>Sales</h1>
  </div>
  <canvas id="myChart" width="800" height="400"></canvas>
  <div id="js-legend" class="chart-legend"></div>

  <canvas id="individualChart" width="800" height="400"></canvas>
  <div id="individual-legend" class="chart-legend"></div>

  <canvas id="comparisonChart" width="800" height="400"></canvas>
  <div id="comparison-legend" class="chart-legend"></div>
  <script>
function updateDataset(legendLi, chart, label) {
  var store = chart.store;
  var exists = false;
  for (var i = 0; i < store.length; i++) {
    if (store[i][0] === label) {
      exists = true;
      chart.datasets.push(store.splice(i, 1)[0][1]);
      legendLi.fadeTo("slow", 1);
    }
  }
  if (!exists) {
    for (var i = 0; i < chart.datasets.length; i++) {
      if (chart.datasets[i].label === label) {
        chart.store.push([label, chart.datasets.splice(i, 1)[0]]);
        legendLi.fadeTo("slow", 0.33);
      }
    }
  }
  chart.update();
}

Number.prototype.formatMoney = function(c, d, t){
  var n = this, 
  c = isNaN(c = Math.abs(c)) ? 2 : c, 
  d = d == undefined ? "." : d, 
  t = t == undefined ? "," : t, 
  s = n < 0 ? "-" : "", 
  i = parseInt(n = Math.abs(+n || 0).toFixed(c)) + "", 
  j = (j = i.length) > 3 ? j % 3 : 0;
  return s + (j ? i.substr(0, j) + t : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + t) + (c ? d + Math.abs(n - i).toFixed(c).slice(2) : "");
};



Chart.defaults.global.responsive = true;
var options = {
    legendTemplate : "<ul class=\"<%%=name.toLowerCase()%>-legend\" style=\"list-style-type: none;\"><%% for (var i=0; i<datasets.length; i++){%><li class=\"legend-item\" onclick=\"updateDataset($(this), window.myBarChart, '<%%=datasets[i].label%>')\"><span style=\"background-color:<%%=datasets[i].strokeColor%>\">&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;<%%if(datasets[i].label){%><%%=datasets[i].label%><%%}%></li><%%}%></ul>",
    multiTooltipTemplate: "<%%= datasetLabel %> - <%%= '$' + value.formatMoney(2) %>"
}
var data = {
  labels: [2011, 2012, 2013, 2014, 2015, 2016],
  datasets: [
    <% @data_sets.each_with_index do |data, i| %>
        <% unless i == 0 %>
          ,
  <% end %>
  {
    label: "<%= data.name %>",
    fillColor: "<%= data.colour %>",
    strokeColor: "<%= data.colour %>",
    pointColor: "<%= data.colour %>",
    pointStrokeColor: "#fff",
    pointHighlightFill: "#fff",
    pointHighlightStroke: "<%= data.colour %>",
    data: <%= data.data %>
}
    <% end %>
  ]
  };

// Get the context of the canvas element we want to select
var ctx = document.getElementById("myChart").getContext("2d");
window.myBarChart = new Chart(ctx).Bar(data, options);
document.getElementById('js-legend').innerHTML = myBarChart.generateLegend();
window.myBarChart.store = new Array();

var options2 = {
    legendTemplate : "<ul class=\"<%%=name.toLowerCase()%>-legend\" style=\"list-style-type: none;\"><%% for (var i=0; i<datasets.length; i++){%><li class=\"legend-item\" onclick=\"updateDataset($(this), window.individualChart, '<%%=datasets[i].label%>')\"><span style=\"background-color:<%%=datasets[i].strokeColor%>\">&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;<%%if(datasets[i].label){%><%%=datasets[i].label%><%%}%></li><%%}%></ul>",
    multiTooltipTemplate: "<%%= datasetLabel %> - <%%= '$' + value.formatMoney(2) %>"
}
var data2 = {
  labels: [2011, 2012, 2013, 2014, 2015, 2016],
  datasets: [
    <% @individual.each_with_index do |data, i| %>
        <% unless i == 0 %>
          ,
  <% end %>
  {
    label: "<%= data.name %>",
    fillColor: "<%= data.colour %>",
    strokeColor: "<%= data.colour %>",
    pointColor: "<%= data.colour %>",
    pointStrokeColor: "#fff",
    pointHighlightFill: "#fff",
    pointHighlightStroke: "<%= data.colour %>",
    data: <%= data.data %>
}
    <% end %>
  ]
  };

// Get the context of the canvas element we want to select
var ctx = document.getElementById("individualChart").getContext("2d");
window.individualChart = new Chart(ctx).Bar(data2, options2);
window.individualChart.store = new Array();
document.getElementById('individual-legend').innerHTML = window.individualChart.generateLegend();

var data3 = {
  labels: ["Current Sales"],
  datasets: [
    <% @comparison.each_with_index do |data, i| %>
        <% unless i == 0 %>
          ,
  <% end %>
  {
    label: "<%= data.name %>",
    fillColor: "<%= data.colour %>",
    strokeColor: "<%= data.colour %>",
    pointColor: "<%= data.colour %>",
    pointStrokeColor: "#fff",
    pointHighlightFill: "#fff",
    pointHighlightStroke: "<%= data.colour %>",
    data: <%= data.data %>
}
    <% end %>
  ]
  };

// Get the context of the canvas element we want to select
var ctx = document.getElementById("comparisonChart").getContext("2d");
var myComparisonChart = new Chart(ctx).Bar(data3, options);
document.getElementById('comparison-legend').innerHTML = myComparisonChart.generateLegend();


  </script>
</div>
